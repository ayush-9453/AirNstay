<!-- header.component.html -->
<nav class="navbar navbar-expand-lg navbar-light bg-light px-4 fixed-top px-5">
    <button class="btn btn-outline-primary" (click)="onbackbutton()"> <i class="bi bi-arrow-left"></i> Back</button>
    <div class="ms-auto d-flex align-items-center">
        <label for="currencySelect" class="me-2 fw-semibold">Currency:</label>
        <select id="currencySelect" class="form-select form-select-sm w-auto" (change)="onCurrencyChange($event)">
            <option value="INR">‚Çπ INR</option>
            <option value="USD">$ USD</option>
            <option value="EUR">‚Ç¨ EUR</option>
            <option value="GBP">¬£ GBP</option>
        </select>
    </div>
</nav>
<br>
<div class="container-fluid py-4 bg-light main-content-container" *ngIf="selectedPackage">
    <div class="row gx-4 pt-4">
        <div class="col-lg-8 left-section mb-4">
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-body">
                    <!-- Header Section -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h5 class="card-title fs-4 fw-bold mb-1">
                                {{ selectedPackage.title }} &mdash; {{ selectedPackage.location }}
                            </h5>
                            <p class="card-subtitle text-muted mb-1">{{ selectedPackage.inclusions }}</p>
                            <!-- <p class="mb-0"><strong>Rating:</strong> {{ selectedPackage.hotelRating }} ‚≠ê</p> -->
                        </div>
                        <div class="text-end">
                            <img class="rounded shadow-sm border" [src]="selectedPackage.imageUrl" alt="Package Image"
                                style="width: 120px; height: 100px; object-fit: cover;">
                        </div>
                    </div>

                    <hr class="my-3">

                    <!-- Duration Section -->
                    <div class="mb-3">
                        <h6 class="text-uppercase text-muted fw-bold">Trip Duration</h6>
                        <p class="mb-0 fs-5 text-primary fw-semibold">
                            <i class="bi bi-calendar-event-fill me-2"></i>{{ selectedPackage.duration }}
                        </p>
                    </div>

                    <hr class="my-3">

                    <!-- Features Section -->
                    <div class="mt-4">
                        <div class="package-features-section mb-4 p-4 rounded-4 feature-panel">
                            <p class="fs-5 fw-bold text-primary mb-3 d-flex align-items-center">
                                <i class="bi bi-gift-fill me-2 fs-4 text-warning"></i> Package Features
                            </p>

                            <div class="d-flex flex-wrap gap-3">
                                <span *ngFor="let feature of selectedPackage.features"
                                    class="feature-pill d-flex align-items-center px-3 py-2 rounded-pill">
                                    <i class="bi bi-check-circle-fill me-2 text-success"></i>{{ feature }}
                                </span>
                            </div>
                        </div>

                        
                        <!-- Cancellation Policy -->
                        <div class="mt-3">
                            <button type="button" class="btn btn-link text-primary fw-bold p-0" data-bs-toggle="modal"
                                data-bs-target="#staticBackdrop">
                                View Cancellation Policy
                            </button>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                            tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="staticBackdropLabel">Cancellation Policy</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p class="small text-muted">
                                            <strong>Important:</strong> This package is non-refundable and cannot be
                                            cancelled without a fee.
                                        </p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="card shadow-sm ">
                <div class="card-header bg-white p-3 collapsed">
                    <h5 class="mb-0 fs-5 fw-semibold d-flex justify-content-between align-items-center">
                        Guest Details
                    </h5><br />
                    <div class="alert alert-warning" role="alert">
                        <p class="text-muted sm-3"><strong>Important:</strong> Enter name as mentioned on your passport
                            or Government approved IDs.</p>
                    </div>

                    <form class="row g-3 " [formGroup]="registrationForm">
                        <div class="col-md-4">
                            <label for="" class="form-label">First name</label>
                            <input type="text" class="form-control" pattern="[a-zA-Z ]*" formControlName="firstName"
                                placeholder="First Name">
                            <div *ngIf="firstName?.dirty || firstName?.touched">
                                <div *ngIf="firstName?.errors?.['required']">
                                    <h6 class="text-danger">First Name cant be empty</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="validationCustom02" class="form-label">Last name</label>
                            <input type="text" class="form-control" pattern="[a-zA-Z ]*" formControlName="lastName"
                                id="validationCustom02" placeholder="Last name">
                            <div *ngIf="lastName?.dirty || lastName?.touched">
                                <div *ngIf="lastName?.errors?.['required']">
                                    <h6 class="text-danger">Last Name cant be empty</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label label for="validationCustom04" class="form-label">Gender</label>
                            <select id="inputGender" class="form-select" id="validationCustom04"
                                formControlName="gender">
                                <option value="Male " selected>Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                                <option value="Prefer not to say">Prefer not to say</option>
                            </select>

                        </div>
                        <div class="col-md-4">
                            <label for="validationCustom03" class="form-label">Age</label>
                            <input type="number" class="form-control" id="validationCustom03" formControlName="age"
                                placeholder="Age" />
                            <div *ngIf="age?.touched && age?.invalid">
                                <h6 class="text-danger" *ngIf="age?.errors?.['required']">Age is required</h6>
                                <h6 class="text-danger" *ngIf="age?.errors?.['min']">Age is too low</h6>
                                <h6 class="text-danger" *ngIf="age?.errors?.['max']">Age is too high</h6>
                            </div>
                        </div>

                        <div class="col-12">
                            <button class="btn btn-primary " type="button" (click)="saveGuest()"
                                [disabled]="isEditMode || !registrationForm.valid"
                                title="Please fill out all fields correctly">Add</button>&nbsp;&nbsp;
                            <button class="btn btn-primary" type="button" (click)="saveGuest()"
                                [disabled]="!isEditMode || registrationForm.invalid">Update</button>&nbsp;&nbsp;
                        </div>
                        <table class="table table-bordered" style="width: 700px; margin-left: 20px; margin-top: 30px;">
                            <thead>
                                <tr>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody *ngIf="PackageGuestLst.length > 0">
                                <tr *ngFor="let traveller of PackageGuestLst">
                                    <td>{{ traveller.firstName }}</td>
                                    <td>{{ traveller.lastName }}</td>
                                    <td>{{ traveller.age }}</td>
                                    <td>{{traveller.gender}}</td>
                                    <td>
                                        <button class="btn btn-link text-success text-decoration-none fw-bold"
                                            (click)="editRecord(traveller)">Edit</button>&nbsp;
                                        <button class="btn btn-link text-danger text-decoration-none fw-bold"
                                            (click)="deleteRecord(traveller.id)">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                    <br />

                    <hr class="my-3">
                    <h5>Booking details will be sent to</h5><br />
                    <form class="row g-3" [formGroup]="bookingForm">
                        <div class="col-md-4">
                            <label for="Country">Country</label>
                            <select class="form-select" formControlName="country">
                                <option>India</option>
                                <option>USA</option>
                                <option>UK</option>
                                <option>Germany</option>
                                <option>Other</option>
                            </select>
                            <div *ngIf="bookingForm.get('country')?.touched && bookingForm.get('country')?.invalid">
                                <small class="text-danger">Country selection is required</small>
                            </div>
                        </div>

                        <!-- Phone Number -->
                        <div class="col-md-4">
                            <label for="phone">Phone Number</label>
                            <input type="number" class="form-control" id="phone" formControlName="phone">
                            <div *ngIf="bookingForm.get('phone')?.touched && bookingForm.get('phone')?.invalid">
                                <small class="text-danger" *ngIf="bookingForm.get('phone')?.errors?.['required']">Phone
                                    number is
                                    required</small>
                                <small class="text-danger" *ngIf="bookingForm.get('phone')?.errors?.['pattern']">Enter a
                                    valid 10-digit
                                    number</small>
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="col-md-4">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" formControlName="email"
                                placeholder="you@example.com">
                            <div *ngIf="bookingForm.get('email')?.touched && bookingForm.get('email')?.invalid">
                                <small class="text-danger" *ngIf="bookingForm.get('email')?.errors?.['required']">Email
                                    is
                                    required</small>
                                <small class="text-danger" *ngIf="bookingForm.get('email')?.errors?.['email']">Enter a
                                    valid email
                                    address</small>
                            </div>
                        </div>
                    </form>
                    <br><br>
                    <div class="card shadow-sm cancellation-policy-panel rounded">
                        <div class="card-header bg-white p-3 collapsed">

                            <form [formGroup]="termsForm">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" formControlName="termsAccepted"
                                        id="termsAccepted">
                                    <label class="form-check-label" for="termsAccepted">
                                        I understand and agree with the
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#fareRulesModal">Fare
                                            Rules</a>, the
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#privacyPolicyModal">Privacy
                                            Policy</a> and
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms &
                                            Conditions</a> of AirNStay.
                                    </label>
                                </div>

                                <div
                                    *ngIf="termsForm.get('termsAccepted')?.touched && termsForm.get('termsAccepted')?.invalid">
                                    <small class="text-danger">You must accept the terms to proceed.</small>
                                </div>

                                <br /><br>
                            </form>

                            <button class="btn btn-primary btn-lg rounded-pill shadow px-4 py-2 hover-effect"
                                [disabled]="isDisabled" [ngClass]="{ 'btn-disabled': isDisabled }"
                                (click)="makePayment()">
                                Proceed to Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 right-section ">
            <div class="fixedpos">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3 fs-5 fw-semibold">Price Breakup</h5>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted fs-6">Total Basic Cost</span>
                            <span class="fw-semibold fs-6">{{ totalBaseFare |
                                currencyConverter:selectedCurrency}}</span>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted fs-6">Taxes and Surcharges</span>
                            <span class="fw-semibold fs-6">{{ taxes | currencyConverter:selectedCurrency }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3 text-success fw-semibold"
                            *ngIf="selectedCouponDiscount > 0">
                            <span class="fs-6">Coupon Applied ({{ selectedCouponCode }})</span>
                            <span class="fs-6">-{{ selectedCouponDiscount | currencyConverter:selectedCurrency }}</span>
                            <span> <button class="btn btn-sm btn-link text-danger"
                                    (click)="removeCoupon()">Remove</button></span>
                        </div>
                        <hr class="my-3">
                        <div class="d-flex justify-content-between align-items-center fw-bold fs-5">
                            <span>Total Amount</span>
                            <span>{{ totalAmount | currencyConverter:selectedCurrency }}</span>
                        </div>

                    </div>
                </div>


                <div class="card shadow-sm tall-card">
                    <div class="scroll-div-auto ">
                        <div class="card-body">
                            <h5 class="card-title mb-3 fs-5 fw-semibold">Coupons and Offers</h5>
                            <div class="input-group mb-3 input-container">
                                <input type="text" [(ngModel)]="manualCouponCode" placeholder="Enter coupon code">
                                <button class="btn btn-primary rounded" (click)="applyManualCoupon()">APPLY</button>
                            </div>
                            <div class="card shadow-sm p-3 mb-5 bg-white rounded">
                                <div class="card-body d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1">AVAILUPI<span
                                                class="text-success text-end fw-bold ">
                                                ‚Çπ300 off</span>
                                        </h5>
                                        <p class="card-text text-muted small">Get an instant discount of ‚Çπ 300 on your
                                            flight and hotel
                                            booking via UPI</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button class="btn btn-link text-primary text-decoration-none fw-bold"
                                            (click)="applyCoupon('AVAILUPI', 300)"> Apply</button>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow-sm p-3 mb-5 bg-white rounded">
                                <div class="card-body d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1">FLAT350<span class="text-success text-end fw-bold">
                                                ‚Çπ350 off</span></h5>
                                        <p class="card-text text-muted small">Get an instant discount of upto ‚Çπ 350 on
                                            your flight and hotel
                                            booking via Cards, Net Banking</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button class="btn btn-link text-primary text-decoration-none fw-bold"
                                            (click)="applyCoupon('FLAT350', 350)">Apply</button>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow-sm p-3 mb-5 bg-white rounded">
                                <div class="card-body d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1">HDFC<span class="text-success text-end fw-bold ">
                                                ‚Çπ1000 off</span>
                                        </h5>
                                        <p class="card-text text-muted small">Get an instant discount of upto ‚Çπ 1000 on
                                            your flight and
                                            hotel booking via HDFC Credit Card</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button class="btn btn-link text-primary text-decoration-none fw-bold"
                                            (click)="applyCoupon('HDFC',1000)">Apply</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card shadow-sm p-3 mb-5 bg-white rounded">
                                <div class="card-body d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1">NEW500<span class="text-success text-end fw-bold ">
                                                ‚Çπ500 off</span></h5>
                                        <p class="card-text text-muted small">Get an instant discount of ‚Çπ 500 on your
                                            flight and hotel
                                            booking to new users.</p>
                                    </div>
                                    <div class="ms-auto">
                                        <button class="btn btn-link text-primary text-decoration-none fw-bold"
                                            (click)="applyCoupon('NEW500', 500)">Apply</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Modal for terms-->
<div class="modal fade" id="fareRulesModal" tabindex="-1" aria-labelledby="fareRulesLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content border-warning shadow">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="fareRulesLabel">Fare Rules ‚Äì Package Bookings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <p class="mb-3">Please review the following fare rules carefully before confirming your travel package
                    with AirNStay:</p>

                <h6 class="text-warning">üì¶ Package Inclusions</h6>
                <ul>
                    <li>Round-trip flights, hotel accommodations, and optional activities or transfers.</li>
                    <li>Meals and excursions are included only if explicitly stated.</li>
                    <li>All components must be booked together and cannot be split.</li>
                </ul>

                <h6 class="text-warning mt-4">üîÑ Cancellation & Changes</h6>
                <ul>
                    <li>Packages are non-refundable once travel begins.</li>
                    <li>Partial cancellations (e.g., hotel only) are not permitted.</li>
                    <li>Changes to travel dates or destinations may incur full rebooking charges.</li>
                    <li>Cancellation fees vary based on airline, hotel, and activity providers.</li>
                </ul>

                <h6 class="text-warning mt-4">üßæ Payment & Confirmation</h6>
                <ul>
                    <li>Full payment is required at the time of booking.</li>
                    <li>Booking is confirmed only after successful payment and issuance of vouchers.</li>
                    <li>Failure to complete payment may result in automatic cancellation.</li>
                </ul>

                <h6 class="text-warning mt-4">üìã Important Notes</h6>
                <ul>
                    <li>Travel insurance is recommended but not included unless specified.</li>
                    <li>Visa and entry requirements are the traveler‚Äôs responsibility.</li>
                    <li>AirNStay is not liable for missed connections due to delays or cancellations.</li>
                </ul>

                <p class="mt-4">By confirming your package, you acknowledge and accept these fare rules. For
                    provider-specific terms, please refer to the airline, hotel, or activity partner‚Äôs official site.
                </p>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-warning" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-labelledby="privacyPolicyLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content border-secondary shadow">
            <div class="modal-header bg-secondary text-white">
                <h5 class="modal-title" id="privacyPolicyLabel">Privacy Policy ‚Äì AirNStay</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <p>AirNStay is committed to protecting your privacy. This policy outlines how we handle your personal
                    information during package bookings.</p>

                <h6 class="text-secondary">üìã Data We Collect</h6>
                <ul>
                    <li>Traveler names, contact details, and payment information.</li>
                    <li>Preferences for flights, hotels, and activities.</li>
                    <li>Device, browser, and location data for personalization and fraud prevention.</li>
                </ul>

                <h6 class="text-secondary mt-4">üîê How We Use Your Data</h6>
                <ul>
                    <li>To coordinate bookings across multiple providers.</li>
                    <li>To personalize package recommendations and itineraries.</li>
                    <li>To comply with legal, immigration, and travel regulations.</li>
                </ul>

                <h6 class="text-secondary mt-4">ü§ù Third-Party Sharing</h6>
                <ul>
                    <li>Data is shared only with airlines, hotels, activity partners, and payment processors.</li>
                    <li>We do not sell or rent your data to advertisers or unauthorized third parties.</li>
                </ul>

                <p class="mt-4">You may request data access or deletion by contacting our support team. For full
                    details, refer to our downloadable Privacy Policy PDF.</p>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content border-dark shadow">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="termsLabel">Terms & Conditions ‚Äì Package Bookings</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <h6 class="text-dark">üìå General Terms</h6>
                <ul>
                    <li>By booking a package through AirNStay, you agree to the terms of all included providers.</li>
                    <li>All components must be used as booked; partial usage does not qualify for refunds.</li>
                    <li>AirNStay is not liable for delays, cancellations, or service failures by third-party providers.
                    </li>
                </ul>

                <h6 class="text-dark mt-4">üì¶ Package-Specific Terms</h6>
                <ul>
                    <li>Packages are priced as bundles; individual component pricing is not disclosed.</li>
                    <li>Changes to one component may affect the entire itinerary and pricing.</li>
                    <li>Activity schedules are subject to change due to weather or operational constraints.</li>
                </ul>

                <h6 class="text-dark mt-4">üë§ Traveler Responsibilities</h6>
                <ul>
                    <li>Travelers must carry valid ID, travel documents, and comply with local laws.</li>
                    <li>Missed flights or check-ins may result in forfeiture of the entire package.</li>
                    <li>Travelers are responsible for verifying visa and vaccination requirements.</li>
                </ul>

                <p class="mt-4">These terms are subject to change. Please review them before each booking. For legal
                    inquiries, contact legal &#64;airnstay.com.</p>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>